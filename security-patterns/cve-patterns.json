{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "CVE and security patterns for infra review (auto-updatable)",
  "version": "1.0.0",
  "patterns": [
    {
      "id": "CVE-2019-5736",
      "name": "runc path traversal",
      "description": "ADD in Dockerfile can lead to path traversal; use COPY",
      "severity": "P0",
      "detection": {
        "type": "regex",
        "scope": "dockerfile",
        "pattern": "^\\s*ADD\\s+"
      },
      "remediation": "Use COPY instead of ADD; for URLs use RUN curl with SHA256"
    },
    {
      "id": "CVE-2022-0847",
      "name": "Dirty Pipe",
      "description": "Ensure non-root user and minimal base image",
      "severity": "P0",
      "detection": {
        "type": "regex",
        "scope": "dockerfile",
        "pattern": "^\\s*USER\\s+root"
      },
      "remediation": "USER <non-root-uid>:<gid>"
    },
    {
      "id": "GHSA-docker-secrets",
      "name": "Secrets in layer",
      "description": "Secrets in ENV or COPY can persist in image layers",
      "severity": "P0",
      "detection": {
        "type": "regex",
        "scope": "all",
        "pattern": "(AWS_ACCESS_KEY_ID|AWS_SECRET_ACCESS_KEY|GITHUB_TOKEN|PRIVATE_KEY)\\s*=\\s*['\"]?[A-Za-z0-9/+=]{20,}"
      },
      "remediation": "Use build secrets (--secret) or runtime injection"
    }
  ]
}
